#!/bin/bash

# Create the irb configuration file
mkdir -p "${HOME}"
cat > "${HOME}/.irbrc" << EOF
require 'awesome_print'
AwesomePrint.irb!
IRB.conf[:SAVE_HISTORY] = 1000
IRB.conf[:HISTORY_FILE] = "#{ENV['HOME']}/.irb-history"
EOF

# Prepare the psql history file
mkdir -p `dirname "${PSQL_HISTORY}"`
touch "${PSQL_HISTORY}"

# Create a symlink for the log directory
mkdir -p /var/log/rails
rm -rf log
ln -nfs /var/log/rails log

# Create a symlink for the tmp directory
mkdir -p /var/tmp/rails
rm -rf tmp
ln -nfs /tmp/rails tmp

# Create a symlink for the tmp directory
mkdir -p /var/tmp/rails
rm -rf tmp
ln -nfs /tmp/rails tmp

# Create a symlink for the public uploads directory
mkdir -p /var/lib/rails/uploads
rm -rf public/uploads
ln -nfs /var/lib/rails/uploads public/uploads

exec $@
